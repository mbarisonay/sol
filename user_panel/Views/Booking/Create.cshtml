@model user_panel.ViewModels.CreateBookingViewModel

@{
    ViewData["Title"] = "Create Booking";
}

<div class="container container-main-large">
    <div class="card-custom">

        <h2 class="text-center">Book a Cabin</h2>
        <p class="text-center text-muted mb-4">You are booking for: <strong>@Model.Cabin.Location</strong></p>

        <!-- Display any error messages from the server -->
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
        }

        <form asp-action="Create" method="get">
            <!-- Hidden input to carry the CabinId through date changes -->
            <input type="hidden" name="id" value="@Model.Cabin.Id" />

            <div class="row">
                <!-- Date Selection -->
                <div class="col-md-6 mb-3">
                    <label asp-for="BookingDate" class="form-label">Select Date</label>

                    <!-- =================================================================== -->
                    <!-- === THE ONLY CHANGE IS HERE: min and max attributes added === -->
                    <!-- This will disable past dates in the calendar. -->
                    <!-- =================================================================== -->
                    <input asp-for="BookingDate"
                           type="date"
                           class="form-control"
                           name="bookingDate"
                           min="@ViewData["MinDate"]"
                           max="@ViewData["MaxDate"]"
                           onchange="this.form.submit()" />
                </div>

                <!-- Time Selection Dropdown -->
                <div class="col-md-6 mb-3">
                    <label class="form-label">Select Time Slot</label>
                    <div class="input-group">
                        <select name="startTimeHour" class="form-select">
                            <option>-- Select a Time --</option>
                            @for (int hour = 9; hour <= 18; hour++)
                            {
                                var timeSlot = Model.BookingDate.AddHours(hour);
                                bool isBooked = Model.BookedHours.Contains(hour);
                                bool isPast = timeSlot < DateTime.Now;

                                <option value="@hour" disabled="@(isBooked || isPast)">
                                    @timeSlot.ToString("t") - @timeSlot.AddHours(1).ToString("t")
                                    @if (isBooked)
                                    {
                                        <text> (Booked)</text>
                                    }
                                    @if (isPast && !isBooked)
                                    {
                                        <text> (Past)</text>
                                    }
                                </option>
                            }
                        </select>
                        <button type="submit" class="btn btn-primary">Book Now</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>